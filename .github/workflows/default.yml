name: default
on: [push]
jobs:
  lint-dockerfile:
    name: Validate dockerfile best practices
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Hadolint
        run: make lint-dockerfile
  lint-shell:
    name: Validate shell scripts best practices
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Hadolint
        run: make lint-shell
  test:
    name: Test images
    strategy:
      matrix:
        php: [7.4, 7.3, 7.2, 7.1, "7.0"]
        variant: [cli, fpm]
    runs-on: ubuntu-latest
    needs: [lint-shell, lint-dockerfile]
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Test image
        run: make PHP_VERSION=${{ matrix.php }} IMAGE_VARIANT=${{ matrix.variant}} OS_VERSION=alpine test-single
